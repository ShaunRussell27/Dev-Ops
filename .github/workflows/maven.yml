# Name of the GitHub Actions workflow

name: Java CI Pipeline

# Trigger rules
# This workflow runs when code is pushed
# or when a pull request is opened against
# the "main" or "dev" branches.

on:
  push:
    branches: [ "main", "dev" ]
  pull_request:
    branches: [ "main", "dev" ]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
 
  # Job name: build
  # Runs on the latest Ubuntu environment
  # provided by GitHub Actions
 
  build:
    runs-on: ubuntu-latest

    steps:
     
      # Step 1: Checkout repository code
      # This pulls repo into the runner
      # so Maven can read pom.xml and build it.
   
      - name: Checkout code
        uses: actions/checkout@v4

   
      # Step 2: Install Java 17
      # Required to compile and run  Java project.
      # "temurin" is the most common OpenJDK distribution.
      #
      # cache: 'maven' stores Maven dependencies
      # to speed up future builds.
    
      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'maven'

  
      # Step 3: Build project with Maven
      # -B = batch mode (no interactive prompts)
      # Runs the default Maven lifecycle until "package"
      # which compiles code and creates the .jar file.
    
      - name: Build with Maven
        run: mvn -B package --file pom.xml

    
      # Step 4: Run unit tests
      # Executes all tests in src/test/java
      # and fails the pipeline if tests fail.
     
      - name: Run tests
        run: mvn test

   
      # Step 5: Run Checkstyle
      # This enforces code style rules (coding standards).
      # The build fails if there are violations.
     
      - name: Run Checkstyle (fails on violations)
        run: mvn -B checkstyle:check

     
      # Step 6: Generate Javadoc documentation
      # Creates HTML API docs under target/site/apidocs.
      
      - name: Generate Javadoc
        run: mvn -B javadoc:javadoc

     
      # Step 7: Upload Javadoc as an artifact
      # Artifacts allow  to download the generated
      # documentation from the Actions UI.
      # path: folder where Javadoc HTML files are stored.
      # name: artifact name that appears in GitHub.
    
      - name: Upload Javadoc artifact
        uses: actions/upload-artifact@v4
        with:
          name: javadoc
          path: target/site/apidocs

      # Publish to GitHub Pages
      #allow to see documentation through github pages
      - name: Upload Javadoc for GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: target/site/apidocs


  #Deploy to GitHub Pages
  deploy:
    needs: build
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4

